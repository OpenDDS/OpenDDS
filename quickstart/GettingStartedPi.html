---
layout: page
title: Raspberry Pi
categories: [opendds]
tags: []
order: 12
---
The goal of this guide is help you download and compile OpenDDS for Linux on the <a hef="https://www.raspberrypi.org/">Raspberry Pi</a> and run a simple example.
<div class="bodytext" align="justify">
  <a name="Build Directions"><span class="headertext">Build Directions</span></a>
  <ol>
    <p>
      For this guide you need a Raspberry Pi set up with Raspbian Bullseye Linux (the Lite variant works) and connected to a local network.
      You will also need a Linux host system (or virtual machine) connected to the same network where we will build OpenDDS.  We have tested with Ubuntu 20.04 x86_64 and CentOS Stream 8 x86_64.
      This guide assumes you know the address and user credentials of the Pi.
      Perform these all these steps on the host computer:
    </p>
    <li><p>Ensure that your host environment has:</p>
      <ul>
        <li>a C++ compiler</li>
        <li>GNU Make</li>
        <li>Perl</li>
        <li>If building with DDS Security: CMake</li>
        <li>Optional Java SDK 1.5 through 1.8 for Java binding support</li>
      </ul>
    </li>
    <li>Download and extract the latest tar.gz file from the <a href="{{ site.data.opendds.downloads_base_url }}/">download site</a>.</li>
    <li>
      Download and extract the <a href="https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf.tar.xz?revision=d0b90559-3960-4e4b-9297-7ddbc3e52783&hash=6F50B04F08298881CA3596CE99E5ABB3925DEB24">Linux GCC 10.2 cross-compiler toolchain</a> from the <a href="https://developer.arm.com/">ARM Developer website</a>.
      Rename the resulting directory from <code>gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf</code> to <code>cross-pi-gcc</code> and move it to <code>/opt</code>.
    </li>
    <li>If building with DDS Security, follow <a href="#thirdparty">the steps below</a> to build OpenSSL and Xerces-C++ for the Pi.</li>
    <li>Enter the OpenDDS-&lt;version&gt; directory</li>
    <li>
      Run the following as a single command.<br/>
      <pre><code>./configure --target=linux-cross --target-compiler=/opt/cross-pi-gcc/bin/arm-none-linux-gnueabihf-g++ (additional options)</code></pre>
      Additional options:
      <ul>
        <li>If using DDS Security:<br/>
          <pre><code>--security --no-tests --openssl=SSL_ROOT --xerces3=XERCESCROOT</code></pre>
          Replace <code>SSL_ROOT</code> and <code>XERCESCROOT</code> with the paths for your system (see <a href="#thirdparty">below</a>).<br/>
          Note that the Google Test Framework is not supported in this configuration, therefore <code>--no-tests</code> is required when using <code>--security</code>.
        </li>
        <li>If using Java bindings:<br/><pre><code>--java</code></pre>
        </li>
      </ul>
    <li><code>make</code></li>
  </ol>

  <p>See <a href="{{ site.baseurl }}/support.html">Support</a> if you encounter problems with configuration or building.</p>

</div>

<div class="bodytext" align="justify">
  <a name="Copying OpenDDS to the Pi"><span class="headertext">Copying OpenDDS to the Pi</span></a>
  <p>There are multiple ways to do this, including using a flash drive. This method uses the network.</p>
  <ol>
    <li>Leave the OpenDDS-&lt;version&gt; directory: <code>cd ..</code></li>
    <li><code>tar czf OpenDDS.tar.gz OpenDDS-&lt;version&gt;</code></li>
    <li>
      <code>scp OpenDDS.tar.gz USER@ADDRESS:</code>
      where USER and ADDRESS are the username and IP address of your Raspberry Pi.
      It will ask you for the password for the user on the Pi.
    </li>
    <li><code>ssh USER@ADDRESS</code> to access the Pi, taking the same information as the previous command.</li>
    <li><code>tar xzf OpenDDS.tar.gz</code></li>
  </ol>
</div>

<div class="bodytext" align="justify">
  <a name="Run the Messenger Example"><span class="headertext">Run the Messenger Example</span></a>
  <ol>
    <li>While still in ssh on the Pi, enter the OpenDDS-&lt;version&gt; directory</li>
    <li><code>export DDS_ROOT="$PWD/build/target"</code></li>
    <li><code>export ACE_ROOT="$DDS_ROOT/ACE_wrappers"</code></li>
    <li><code>export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:"$ACE_ROOT/lib":"$DDS_ROOT/lib"</code></li>
    <li><code>export PATH=${PATH}:"$ACE_ROOT/bin":"$DDS_ROOT/bin"</code></li>
    <li><code>cd $DDS_ROOT/DevGuideExamples/DCPS/Messenger</code> for C++ example or <code>cd $DDS_ROOT/java/tests/messenger</code> for Java example</li>
    <li><code>./run_test.pl</code></li>
  </ol>
  <p>The Messenger Example starts an InfoRepo, publisher, and subscriber.
    The InfoRepo allows the publisher and subscriber to find each other.
    Once the publisher finds the subscriber, it sends 10 messages to the subscriber and waits 30 seconds for the subscriber to acknowledge the messages.
  </p>
</div>

<div class="bodytext" align="justify">
  <a name="Next Steps"><span class="headertext">Next Steps</span></a>
  <p>See Chapter 2 of the <a href="{{ site.data.opendds.latest_devguide_url }}">Developer's Guide</a> for a detailed explanation of the Messenger C++ Example or Chapter 10 for the Java Example.</p>
</div>

<div class="bodytext" align="justify">
  <p><a name="thirdparty"><span class="headertext">Building Third-Party Libraries</span></a></p>
  <div class="subheadertext">Setup</div>
  <ol>
    <li>Create and enter a directory to perform the build.</li>
    <li>Set the <code>BUILD_ROOT</code> shell variable to the working directory.</li>
    <li>This will be the parent directory for the source repos and "staged"
      installation directories for the cross-compiled software.</li>
  </ol>
  <div class="subheadertext">OpenSSL</div>
  <ol>
    <li>In <code>$BUILD_ROOT</code>, download and extract the
      <a href="https://www.openssl.org/source/">
        OpenSSL source archive</a>, and change to that extracted
      directory. See <a href="https://github.com/objectcomputing/OpenDDS/blob/latest-release/docs/dependencies.md#openssl">
      here</a> for any version requirements for OpenSSL.
    </li>
    <li><code>./Configure --cross-compile-prefix=/opt/cross-pi-gcc/bin/arm-none-linux-gnueabihf-
        linux-armv4</code></li>
    <li><code>make</code></li>
    <li><code>make install DESTDIR=$BUILD_ROOT/pi-openssl</code></li>
  </ol>
  <div class="subheadertext">Xerces-C++</div>
  <ol>
    <li>In <code>$BUILD_ROOT</code>, create the file <code>PiToolchain.cmake</code> with the
      contents:<pre>
set(CMAKE_SYSTEM_NAME Linux)
set(CMAKE_SYSTEM_PROCESSOR arm)
set(CMAKE_C_COMPILER /opt/cross-pi-gcc/bin/arm-none-linux-gnueabihf-gcc)
set(CMAKE_CXX_COMPILER /opt/cross-pi-gcc/bin/arm-none-linux-gnueabihf-g++)
set(CMAKE_FIND_ROOT_PATH /opt/cross-pi-gcc/arm-none-linux-gnueabihf)
set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)
set(THREADS_PTHREAD_ARG 2)</pre></li>
    <li>In <code>$BUILD_ROOT</code>, download and extract the
      <a href="https://xerces.apache.org/xerces-c/download.cgi">
        Xerces-C++ source archive</a>, and change to that extracted
      directory. See <a href="https://github.com/objectcomputing/OpenDDS/blob/latest-release/docs/dependencies.md#xerces">
      here</a> for any version requirements for Xerces.
    </li>
    <li><code>mkdir build-pi; cd build-pi</code></li>
    <li><code>cmake -DCMAKE_TOOLCHAIN_FILE=$BUILD_ROOT/PiToolchain.cmake
        -DCMAKE_INSTALL_PREFIX=$BUILD_ROOT/pi-xerces ..</code></li>
    <li><code>make</code></li>
    <li><code>make install</code></li>
  </ol>
  <div class="subheadertext">Using these with OpenDDS</div>
  <ul>
    <li>For <code>configure</code> (see <a href="#Build Directions">above</a>)
      <ul>
        <li>SSL_ROOT is <code>$BUILD_ROOT/pi-openssl/usr/local</code></li>
        <li>XERCESCROOT is <code>$BUILD_ROOT/pi-xerces</code></li>
      </ul>
    </li>
    <li>For runtime loading of shared objects
      <ul>
        <li>copy <code>$BUILD_ROOT/pi-openssl/usr/local/lib/libcrypto.so.1.1</code>
          to <code>build/target/lib</code></li>
        <li>copy <code>$BUILD_ROOT/pi-xerces/lib/libxerces-c-3.2.so</code> to
          <code>build/target/lib</code></li>
      </ul>
    </li>
  </ul>
</div>
